const osu = require('node-os-utils');
const logUpdate = require('log-update');
const prettyjson = require('prettyjson');
const props = require('./config');

class SystemInformation {
  constructor (interval) {
    this.systemData = {
      'Interval': interval || props.DEFAULT_INTERVAL
    };
  }

  updateSystemUsage (updateParamList) {
    updateParamList.forEach(element => {
      if (element === 'ram') {
        osu.mem.info().then(ramMemoryData => {
          this.systemData.RAM_Usage = `${parseFloat(
            (ramMemoryData.usedMemMb * props.STATIC_PROCENT) /
              ramMemoryData.totalMemMb
          ).toFixed(props.DIGITS_DECIMAL_POINT)}%`;
        });
      };
      if (element === 'cpu') {
        osu.cpu.usage().then(cpuUsageData => {
          this.systemData.CPU_Usage = `${cpuUsageData}%`;
        });
      };
    });
  };

  print () {
    let styleOptions = { };
    logUpdate(
      `${prettyjson.render(this.systemData, styleOptions)}`
    );
  }

  log (optionList) {
    setInterval(() => {
      this.updateSystemUsage(optionList);
      this.print();
    }, this.systemData.Interval);
  }
  get (optionList) {
    this.updateSystemUsage(optionList);
    return this.systemData;
  }
}

module.exports = SystemInformation;
